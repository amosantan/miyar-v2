# Manus → Antigravity Migration

## Already Done (Pre-migration)
- [x] Database tables created on PlanetScale (47 tables)
- [x] LLM service migrated to Gemini ([server/_core/llm.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/_core/llm.ts))
- [x] Image generation migrated to Gemini Imagen ([server/_core/imageGeneration.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/_core/imageGeneration.ts))
- [x] Notification service migrated to Resend ([server/_core/notification.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/_core/notification.ts))
- [x] Local auth (login/register) routes built ([server/routers/auth.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/routers/auth.ts))
- [x] Login page built ([client/src/pages/Login.tsx](file:///Users/amrosaleh/Maiyar/miyar-v2/client/src/pages/Login.tsx))
- [x] OAuth routes gutted ([server/_core/oauth.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/_core/oauth.ts))
- [x] Audit codebase for all Manus dependencies

## Migration Work (This Session)

### 1. Auth System — Remove Manus OAuth SDK
- [x] Refactor [server/_core/sdk.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/_core/sdk.ts) to remove Manus OAuth (kept JWT session logic)
- [x] Delete `server/_core/types/manusTypes.ts`
- [x] Clean up ENV vars: removed `oAuthServerUrl`, `appId`, `forgeApiUrl`, `forgeApiKey`

### 2. Client — Remove Manus UI & References
- [x] Delete `client/src/components/ManusDialog.tsx`
- [x] Rename `manus-runtime-user-info` → `miyar-user-info` in `useAuth.ts`
- [x] Verified ManusDialog not imported anywhere else
- [x] Updated [client/src/components/Map.tsx](file:///Users/amrosaleh/Maiyar/miyar-v2/client/src/components/Map.tsx) (Forge proxy → direct Google Maps API)

### 3. Vite Config — Remove Manus Debug Collector
- [x] Removed `vitePluginManusDebugCollector` plugin from [vite.config.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/vite.config.ts)
- [x] Removed Manus domains from `server.allowedHosts`
- [x] Deleted `client/public/__manus__/` directory

### 4. Server Utilities — Replace Forge Proxy
- [x] Deleted `server/_core/dataApi.ts` (unused)
- [x] Refactored [server/_core/map.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/_core/map.ts) (Forge proxy → direct Google Maps API key)

### 5. Voice Transcription
- [x] Decision: Kept OpenAI Whisper (battle-tested, no change needed)

### 6. Environment Config
- [x] Updated [server/_core/env.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/_core/env.ts) with clean env vars
- [x] Created `.env.example` with all required env vars documented

### 7. Cleanup
- [x] Deleted `.manus/` directory
- [x] Updated [notification.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/_core/notification.ts) comment (removed Manus reference)
- [x] Updated [auth.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/_core/oauth.ts) comment (removed Manus reference)

## Phase 2: Material & Evidence Data Enrichment
- [x] Research UAE market sources for stone, wood, tiles, and paint
- [x] Map market data to Miyar tier systems (Luxury, Premium, Mid)
- [x] Implement enriched seeding script ([scripts/seed-enriched.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/scripts/seed-enriched.ts))
- [x] Execute seeding and verify database counts
- [x] Visual verification in Material Library and Evidence Vault

## Phase 3: DSC Price Data Integration
- [x] Analyze `Dsc_Average_Construction_Material_Prices_*.csv` structure
- [x] Create implementation plan for official benchmark integration
- [x] Implement parser script for building/core raw materials
- [x] Populate `evidence_records` with Q3 2024 official data
- [x] Verify core material benchmarks in the Analytics Dashboard

## Phase 4: CSV Data Recovery
- [x] Analyze `miyar-v2-csv-backup` contents
- [x] Create implementation plan for batch CSV ingestion
- [x] Implement generic CSV parser/importer script
- [x] Restore missing `source_registry` and `competitor_entities`
- [x] Verify data completeness across all modules

## Phase 5: Self-Learning Platform (V5)
- [x] V5-01: Wire Outcome Capture to Predictive Engine Comparison
- [x] V5-02: Prediction Accuracy Tracking Over Time (Ledger)
- [x] V5-03: Outcome-Driven Benchmark Calibration
- [x] V5-04: Logic Registry Weight Sensitivity Analysis
- [x] V5-05: Outcome Capture UI Upgrade
- [x] V5-06: Learning Intelligence Dashboard
- [x] V5-07: Build the Pattern Library
- [x] V5-08: Pattern-Informed Project Recommendations
- [x] V5-09: Learning Engine Resilience
- [x] V5-10: Full V5 Test Suite
- [x] Deliver V5 Phase Reality Report

## Phase 6: Data Freshness Engine (DFE)
- [x] DFE-01: Upgrade Source Registry to Fully Configurable
- [x] DFE-02: Expand to 50 UAE Data Sources
- [x] DFE-03: CSV/Excel Supplier Price List Upload
- [x] DFE-04: Bulk Evidence Import from Standard Template
- [x] DFE-05: Price Change Detection & Alerts
- [x] DFE-06: Data Staleness Monitoring Dashboard
- [x] DFE-07: Multi-Schedule Cron Orchestrator
- [x] DFE-08: Scraping Resilience Hardening
- [x] DFE-09: Full DFE Test Suite
- [x] Deliver DFE Reality Report

## Phase 9: Strategic Gap Analysis & Master Plan Execution
- [x] Extract text from 35 origin PDF Blueprints
- [x] Store Blueprints as Markdown artifacts in `/spec_documents`
- [x] Compare current codebase against Blueprints
- [x] Generate [master_plan_gap_analysis.md](file:///Users/amrosaleh/.gemini/antigravity/brain/7c19b7ce-bcbf-4927-9935-14273b999ad2/master_plan_gap_analysis.md)
- [x] Determine next feature sequence with User

## Phase 10: Phase V9 - Strategic Risk & Economic Modeling
- [x] V9-01: Create database schema (`project_roi_models`, `scenario_stress_tests`, `risk_surface_maps`)
- [x] V9-02: Implement Economic ROI Engine (Cost Avoidance & Acceleration)
- [x] V9-03: Implement Aggregate Risk Intelligence (Macro-Economic Shocks & scoring)
- [ ] V9-04: Implement Scenario Ranking & tRPC endpoints
- [ ] V9-05: Write tests and guarantee baseline pass
- [ ] V9-06: Deliver V9 Reality Report
