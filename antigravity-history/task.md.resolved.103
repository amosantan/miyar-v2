# Design Intelligence Engine — Task Tracker

Last updated: 2026-02-27

---

## Phase 1 — Audit & Connect ✅ COMPLETE
- [x] 1.1 Audit existing router endpoints (designRouter + designAdvisorRouter confirmed registered)
- [x] 1.2 Confirm DesignBrief, DesignAdvisor, DesignStudio pages are routed in App.tsx
- [x] 1.3 Audit dead pages — confirmed all routes registered
- [x] 1.4 Fix missing link: `material_constants` table was seeded but NEVER queried
  - [x] Add [getMaterialConstants()](file:///Users/amrosaleh/Maiyar/miyar-v2/server/db.ts#2066-2072) + [getMaterialConstantByType()](file:///Users/amrosaleh/Maiyar/miyar-v2/server/db.ts#2073-2082) to [server/db.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/db.ts)
  - [x] Add `design.getMaterialConstants` tRPC endpoint
  - [x] Add `design.calculateSpec` mutation (input: material types + areas → cost/carbon/sustainability grade/maintenance)

**Commit:** `a6da478`

---

## Phase 2 — Investor Dashboard ✅ COMPLETE
- [x] 2.1 New page: [client/src/pages/InvestorSummary.tsx](file:///Users/amrosaleh/Maiyar/miyar-v2/client/src/pages/InvestorSummary.tsx) (route: `/projects/:id/investor-summary`)
- [x] 2.2 Section A — Design Identity (typology, style, tier, exec summary, design direction JSON)
- [x] 2.3 Section B — Material Spec Panel (space recs + live AED/m² reference from `material_constants`)
- [x] 2.4 Section C — Budget Synthesis (total fitout cost, cost/sqm, budget bar chart by space)
- [x] 2.5 Section D — ROI Bridge (sustainability grade, maintenance indicator, sales premium by tier, net uplift)
- [x] 2.6 Add "Investor View" button (violet) to [ProjectDetail.tsx](file:///Users/amrosaleh/Maiyar/miyar-v2/client/src/pages/ProjectDetail.tsx) header

**Commit:** `a6da478`

---

## Phase 3 — Brief → Numbers ✅ COMPLETE
- [x] 3.1 Enrich [design-brief.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/design-brief.ts) engine with `pricingAnalytics` section
  - [x] Add [PricingAnalytics](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/design-brief.ts#10-37) interface (costPerSqmAvg, totalFitoutCostAed, totalCarbonKg, avgMaintenanceFactor, sustainabilityGrade, materialBreakdown, designPremiumAed, designPremiumPct)
  - [x] Add `TIER_MATERIAL_TYPES` + `TIER_PREMIUM_PCT` lookup maps
  - [x] Accept optional `materialConstants[]` param in [generateDesignBrief()](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/design-brief.ts#207-497)
  - [x] Compute + inject `pricingAnalytics` into brief return value
- [x] 3.2 Update `generateBrief` router — fetch `matConstants` from DB, pass to engine
- [x] 3.3 New page: [client/src/pages/BriefEditor.tsx](file:///Users/amrosaleh/Maiyar/miyar-v2/client/src/pages/BriefEditor.tsx) (route: `/projects/:id/brief-editor`)
  - [x] 9 material type toggles with area allocation sliders (% of GFA)
  - [x] Live cost recalculation via `design.calculateSpec` useMutation (fires on every change)
  - [x] Display: Total Fitout Cost, Sustainability Grade A–E, Maintenance Factor, Carbon kg CO₂
  - [x] Per-material breakdown list with AED/m² badges
  - [x] ROI Bridge panel + deep link to Investor Summary
  - [x] UAE Market Constants reference table sidebar
- [x] Add "Brief Editor" button (emerald, Calculator icon) to [ProjectDetail.tsx](file:///Users/amrosaleh/Maiyar/miyar-v2/client/src/pages/ProjectDetail.tsx) header

**Commit:** `ca40d00`

---

## Phase 4 — Market Grounding ⬜ NOT STARTED
- [ ] 4.1 Connect `designTrends` table → `generateRecommendations` Gemini prompt
  - Query trending styles/materials from `designTrends` (populated by ingestion)
  - Inject as bias signals into the design-advisor Gemini prompt
- [ ] 4.2 Overlay `benchmarkData` on BriefEditor / InvestorSummary cost/sqm display
  - Pull benchmark for same `mkt01Tier` + `ctx04Location`
  - Show "Market benchmark: AED X/sqm" alongside the material_constants estimate
- [ ] 4.3 Competitor context in brief
  - Surface top 3 from `sourceRegistry` with similar style + tier
  - Add "Competitor Context" section to generated design brief

---

## Phase 5 — Export & Handover ⬜ NOT STARTED
- [ ] 5.1 Enhance DOCX export (`docx-brief.ts`)
  - Add material spec table with costs
  - Add budget summary table
  - Embed AI-generated images
- [ ] 5.2 PDF Investor Report (`server/engines/investor-report-pdf.ts`)
  - Design Identity + Visual renders + Material costs + ROI bridge + Market benchmarks
  - Generate using `pdfkit` or `puppeteer`
- [ ] 5.3 Shareable public link
  - Endpoint: `design.createShareLink`
  - Token-gated URL: `/share/:token` renders InvestorSummary without login
