# Overhaul Design Brief for Dubai Interior Designers

Based on Dubai market standards, Interior Designers expect a comprehensive brief that serves as an actionable instruction manual rather than a high-level creative guideline or a financial/scoring validation report. 

Currently, the [generateDesignBriefHTML](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/pdf-report.ts#718-736) function in [server/engines/pdf-report.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/pdf-report.ts) primarily outputs the Evaluation/Scoring matrices (e.g., 5-Lens Defensibility, Risk Assessment) and does not output a true Interior Design Brief. Furthermore, the [server/engines/design-brief.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/design-brief.ts) logic lacks the detailed material specifications, Bill of Quantities (BOQ), and localized workflow instructions expected in Dubai.

## Proposed Changes

### 1. Identify and Restructure the Design Brief Data Logic
The current [DesignBriefData](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/design-brief.ts#9-58) interface and generation logic in [server/engines/design-brief.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/design-brief.ts) will be overhauled to include the exact instructions, materials, budgets, and BOQ frameworks that designers need.

#### [MODIFY] [server/engines/design-brief.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/design-brief.ts)
- **Update Interface [DesignBriefData](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/design-brief.ts#9-58):**
  - `projectIdentity`: Add specific property types and Dubai-centric details.
  - `designNarrative` (Replacing styleMood): Provide a clearer creative vision.
  - `materialSpecifications` (Replacing materialGuidance): Define exact materials they *can* use, avoid, with quality benchmarks and sourcing instructions (local vs imported).
  - `boqFramework` (NEW): Provide a Bill of Quantities breakdown based on GFA, split into high-level categories (e.g., Civil/MEP, Flooring, Joinery, FF&E) with estimated unit counts and allocations.
  - `detailedBudget` (Replacing budgetGuardrails): Total allocated budget with a target cost per sqm, contingencies, and value engineering matrices.
  - `designerInstructions` (Replacing deliverablesChecklist): Dubai-specific instructions, including obtaining Dubai Municipality/Civil Defense approvals, MEP coordination, and phased deliverable expectations.
- **Refactor [generateDesignBrief](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/design-brief.ts#131-294):** Map the [ProjectInputs](file:///Users/amrosaleh/Maiyar/miyar-v2/shared/miyar-types.ts#15-51) to this new structure effectively.

### 2. Overhaul the PDF/HTML Report Generation
Currently, when a user exports the "Design Brief" to PDF/HTML, the S3 report generated by [server/engines/pdf-report.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/pdf-report.ts) simply lists validation scores (Risk, Sensitivity, etc.). This makes the report look like a financial summary rather than a Design Brief.

#### [MODIFY] [server/engines/pdf-report.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/pdf-report.ts)
- **Refactor [generateDesignBriefHTML](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/pdf-report.ts#718-736):**
  - It will start taking the actual [DesignBriefData](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/design-brief.ts#9-58) generated by [server/engines/design-brief.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/design-brief.ts) as an input (or generating it internally).
  - Render the new Dubai Market sections: 
    - Material Specifications & Sourcing
    - Bill of Quantities (BOQ) Framework Table
    - Budget Breakdown
    - Project Workflow & Authority Approvals (Dubai Municipality, etc.)
  - Keep a brief summary of the validation score, but move the focus heavily onto the actionable interior design instructions.

#### [MODIFY] [shared/miyar-types.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/shared/miyar-types.ts)
- If necessary, update the [PDFReportInput](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/pdf-report.ts#640-656) to include the [DesignBriefData](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/design-brief.ts#9-58) so it can be passed from the router to the HTML generator.

### 3. Update the DOCX Export
The system also allows downloading the brief as a `.docx` file using [docx-brief.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/docx-brief.ts).

#### [MODIFY] [server/engines/docx-brief.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/docx-brief.ts)
- Update the table generation to match the newly added BOQ Framework, Materials Instructions, and Dubai-specific workflow requirements.

### 4. Router Wiring
Ensure the data passes correctly from the `/project/[id]/design-brief` endpoint or `reports` endpoint down to the PDF generator.

#### [MODIFY] [server/routers/project.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/routers/project.ts) and [server/routers/design.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/routers/design.ts)
- Ensure that the new [DesignBriefData](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/design-brief.ts#9-58) is generated and passed directly into the PDF HTML generator when the user selects the "Design Brief" report export option.

## Verification Plan

### Automated Tests
- Run `npm run test` or `npx vitest run` focusing on [v28.test.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/v28.test.ts) and [credibility-fixes.test.ts](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/credibility-fixes.test.ts) to fix any typescript mapping errors caused by changing [DesignBriefData](file:///Users/amrosaleh/Maiyar/miyar-v2/server/engines/design-brief.ts#9-58) fields.
- Ensure the newly added BOQ array logic handles default boundaries correctly (0 GFA cases, varying target tiers).

### Manual Verification
- Review the generated PDF HTML mock locally or request user feedback to ensure the new HTML matches the exact expectations of an Interior Designer working in Dubai.
